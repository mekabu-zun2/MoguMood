# 実装計画

- [x] 1. Next.js + TypeScript + TailwindCSS + Docker 環境構築

  - Next.js 14 (App Router) プロジェクトを作成し、TypeScript と TailwindCSS を設定する
  - Dockerfile と docker-compose.yml を作成し、開発環境でホットリロードが動作することを確認する
  - 環境変数管理用の.env.example ファイルを作成し、必要な API キー項目を定義する
  - _要件: 8.1, 8.4, 9.1, 9.2, 9.3, 9.4_

- [x] 2. 基本的な型定義とユーティリティ関数を実装

  - 検索状態、レストラン結果、API 関連の型定義を作成する
  - 定数定義（半径範囲、駅数範囲など）とヘルパー関数を実装する
  - エラーハンドリング用のユーティリティ関数を作成する
  - _要件: 8.1_

- [x] 3. Gemini API 統合サービスを実装

  - Gemini API を呼び出すサービス関数を作成する
  - 気分テキストを検索タグに変換するロジックを実装する
  - エラーハンドリングとリトライ機能を含める
  - _要件: 2.2, 2.3_

- [x] 4. Google Places API 統合サービスを実装

  - Google Places API（Nearby Search）を呼び出すサービス関数を作成する
  - Google Places Photo API で画像を取得する機能を実装する
  - レスポンスデータを統一フォーマットに変換する処理を作成する
  - _要件: 3.3, 5.5_

- [x] 5. Google Directions API 統合サービスを実装

  - 最寄り駅検索（type=train_station）機能を実装する
  - 指定駅数分の駅リストを取得するロジックを作成する
  - 各駅の緯度経度情報を取得する処理を実装する
  - _要件: 4.2, 4.3, 4.4_

- [x] 6. Next.js API Routes 実装
- [x] 6.1 気分変換 API エンドポイント作成

  - `/api/mood` エンドポイントを作成し、Gemini API サービスを呼び出す
  - 入力値検証とエラーハンドリングを実装する
  - API レスポンス形式を統一する
  - _要件: 2.2, 2.4_

- [x] 6.2 飲食店検索 API エンドポイント作成

  - `/api/places` エンドポイントを作成し、Google Places API サービスを呼び出す
  - 半径モードと駅数モードの両方に対応する
  - 検索結果に Google マップ URL を生成して含める
  - _要件: 3.3, 4.4, 6.3_

- [x] 6.3 駅検索 API エンドポイント作成

  - `/api/stations` エンドポイントを作成し、Google Directions API サービスを呼び出す
  - 最寄り駅特定と駅数分のルート取得機能を実装する
  - エラーハンドリングと適切なレスポンス形式を設定する
  - _要件: 4.2, 4.3_

- [x] 7. 位置情報取得カスタムフック実装

  - useGeolocation フックを作成し、navigator.geolocation で現在地を取得する
  - 位置情報取得の成功・失敗状態を管理する
  - 位置情報拒否時のエラーハンドリングを実装する
  - _要件: 3.2, 3.4_

- [x] 8. 検索状態管理カスタムフック実装

  - useSearchState フックを作成し、検索モード、気分、半径、駅数の状態を管理する
  - 検索実行、ローディング状態、エラー状態の管理機能を実装する
  - 検索結果の状態管理とキャッシュ機能を追加する
  - _要件: 1.4, 2.4, 3.1, 4.1_

- [x] 9. API 呼び出しカスタムフック実装
- [x] 9.1 気分変換フック作成

  - useMoodConversion フックを作成し、気分変換 API を呼び出す
  - デバウンス処理で不要な API 呼び出しを削減する
  - 変換結果のキャッシュ機能を実装する
  - _要件: 2.2, 2.3_

- [x] 9.2 飲食店検索フック作成

  - usePlacesSearch フックを作成し、飲食店検索 API を呼び出す
  - 半径モードと駅数モードの両方に対応する検索ロジックを実装する
  - 検索結果の並び替えとフィルタリング機能を追加する
  - _要件: 3.3, 4.4, 5.1_

- [x] 9.3 駅検索フック作成

  - useStationSearch フックを作成し、駅検索 API を呼び出す
  - 最寄り駅の特定と駅数分のルート取得機能を実装する
  - 駅情報のキャッシュとエラーハンドリングを追加する
  - _要件: 4.2, 4.3, 4.4_

- [ ] 10. モード切替 UI コンポーネント実装

  - ModeToggle コンポーネントを作成し、半径モードと駅数モードの切り替えを実装する
  - タッチフレンドリーなトグル UI を作成し、44px 以上のタップ領域を確保する
  - アクセシビリティ対応（ARIA 属性、キーボード操作）を実装する
  - _要件: 1.1, 1.2, 1.3, 1.4, 7.2_

- [ ] 11. 気分入力 UI コンポーネント実装

  - MoodInput コンポーネントを作成し、自由テキスト入力フィールドを実装する
  - リアルタイムでの入力値検証とフィードバック表示を追加する
  - プレースホルダーテキストとヘルプテキストを設定する
  - _要件: 2.1, 7.2_

- [ ] 12. 半径指定 UI コンポーネント実装

  - RadiusSlider コンポーネントを作成し、500m〜5000m の範囲でスライダーを実装する
  - 現在値の表示とスムーズなスライダー操作を実現する
  - モバイル端末でのタッチ操作に最適化する
  - _要件: 3.1, 7.2_

- [ ] 13. 駅数指定 UI コンポーネント実装

  - StationCounter コンポーネントを作成し、1〜5 駅の範囲で駅数を指定できる UI を実装する
  - +/-ボタンまたはセレクトボックスで駅数を選択する機能を追加する
  - 選択された駅数の視覚的フィードバックを提供する
  - _要件: 4.1, 7.2_

- [ ] 14. 検索フォームコンポーネント実装

  - SearchForm コンポーネントを作成し、モード切替、気分入力、範囲指定を統合する
  - 検索ボタンの実装と検索実行時のローディング状態表示を追加する
  - フォーム全体のバリデーションとエラー表示機能を実装する
  - _要件: 1.4, 2.4, 3.1, 4.1_

- [ ] 15. 検索結果カードコンポーネント実装

  - ResultCard コンポーネントを作成し、店名、ジャンル、評価、写真を表示する
  - 半径モードでは距離、駅数モードでは最寄り駅名を表示する機能を実装する
  - 「Google マップで開く」ボタンを配置し、適切な URL で遷移する機能を追加する
  - _要件: 5.1, 5.2, 5.3, 5.4, 5.5, 6.1, 6.2, 6.3_

- [ ] 16. 検索結果一覧コンポーネント実装

  - ResultList コンポーネントを作成し、検索結果カードを一覧表示する
  - 縦スクロール 1 カラムレイアウトでモバイル最適化を実現する
  - 検索結果が 0 件の場合の表示とエラー状態の表示を実装する
  - _要件: 5.1, 7.1, 7.3_

- [ ] 17. ローディングとエラー表示コンポーネント実装

  - Loader コンポーネントを作成し、検索中の適切なローディング表示を実装する
  - ErrorMessage コンポーネントを作成し、ユーザーフレンドリーなエラーメッセージを表示する
  - リトライボタンとエラー回復機能を追加する
  - _要件: 7.4_

- [ ] 18. メインページコンポーネント統合

  - Home ページコンポーネントを作成し、全ての UI コンポーネントを統合する
  - 検索フローの全体的な状態管理と画面遷移を実装する
  - レスポンシブデザインでスマートフォン表示を最適化する
  - _要件: 7.1, 7.3_

- [ ] 19. スマートフォン対応とアクセシビリティ改善

  - 全コンポーネントでタップ領域 44px 以上を確保し、タッチ操作を最適化する
  - ARIA 属性、セマンティック HTML、キーボード操作対応を実装する
  - 画面サイズに応じたレスポンシブレイアウトを調整する
  - _要件: 7.1, 7.2, 7.3_

- [ ] 20. エラーハンドリングとユーザー体験向上

  - 位置情報拒否、ネットワークエラー、API 呼び出し失敗の各エラーケースに対応する
  - 非侵入的なトースト通知とインラインエラーメッセージを実装する
  - リトライ機能とフォールバック検索機能を追加する
  - _要件: 3.4_

- [ ] 21. パフォーマンス最適化実装

  - React.memo、useMemo、useCallback を使用してコンポーネントの再レンダリングを最適化する
  - 画像の遅延読み込み（Lazy Loading）を実装する
  - バンドルサイズの最適化と Tree Shaking を確認する
  - _要件: 7.3_

- [ ] 22. テスト実装
- [ ] 22.1 ユニットテスト作成

  - カスタムフック（useGeolocation、useMoodConversion、usePlacesSearch）のテストを作成する
  - ユーティリティ関数と API サービス関数のテストを実装する
  - Jest + React Testing Library を使用してテスト環境を構築する

- [ ] 22.2 コンポーネントテスト作成

  - 各 UI コンポーネントの描画テストとユーザーインタラクションテストを作成する
  - プロップスの受け渡しとイベントハンドリングのテストを実装する
  - MSW を使用して API モックを設定する

- [ ] 22.3 統合テスト作成

  - API Routes のエンドポイントテストを作成する
  - フロントエンド・バックエンド間の通信テストを実装する
  - エラーケースとエッジケースのテストを追加する

- [ ] 23. Docker 環境最終調整とドキュメント作成
  - 本番環境想定のマルチステージビルドを実装する
  - README.md に環境構築手順、API 設定方法、使用方法を記載する
  - .env.example ファイルを完成させ、必要な API キーの取得方法を説明する
  - _要件: 8.1, 8.2, 8.3, 8.4, 9.1, 9.2, 9.3, 9.4_
