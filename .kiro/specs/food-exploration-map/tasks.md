# 実装計画

- [ ] 1. Next.js + TypeScript + TailwindCSS + Docker環境構築
  - Next.js 14 (App Router) プロジェクトを作成し、TypeScriptとTailwindCSSを設定する
  - Dockerfileとdocker-compose.ymlを作成し、開発環境でホットリロードが動作することを確認する
  - 環境変数管理用の.env.exampleファイルを作成し、必要なAPIキー項目を定義する
  - _要件: 8.1, 8.4, 9.1, 9.2, 9.3, 9.4_

- [ ] 2. 基本的な型定義とユーティリティ関数を実装
  - 検索状態、レストラン結果、API関連の型定義を作成する
  - 定数定義（半径範囲、駅数範囲など）とヘルパー関数を実装する
  - エラーハンドリング用のユーティリティ関数を作成する
  - _要件: 8.1_

- [ ] 3. Gemini API統合サービスを実装
  - Gemini APIを呼び出すサービス関数を作成する
  - 気分テキストを検索タグに変換するロジックを実装する
  - エラーハンドリングとリトライ機能を含める
  - _要件: 2.2, 2.3_

- [ ] 4. Google Places API統合サービスを実装
  - Google Places API（Nearby Search）を呼び出すサービス関数を作成する
  - Google Places Photo APIで画像を取得する機能を実装する
  - レスポンスデータを統一フォーマットに変換する処理を作成する
  - _要件: 3.3, 5.5_

- [ ] 5. Google Directions API統合サービスを実装
  - 最寄り駅検索（type=train_station）機能を実装する
  - 指定駅数分の駅リストを取得するロジックを作成する
  - 各駅の緯度経度情報を取得する処理を実装する
  - _要件: 4.2, 4.3, 4.4_

- [ ] 6. Next.js API Routes実装
- [ ] 6.1 気分変換APIエンドポイント作成
  - `/api/mood` エンドポイントを作成し、Gemini APIサービスを呼び出す
  - 入力値検証とエラーハンドリングを実装する
  - APIレスポンス形式を統一する
  - _要件: 2.2, 2.4_

- [ ] 6.2 飲食店検索APIエンドポイント作成
  - `/api/places` エンドポイントを作成し、Google Places APIサービスを呼び出す
  - 半径モードと駅数モードの両方に対応する
  - 検索結果にGoogleマップURLを生成して含める
  - _要件: 3.3, 4.4, 6.3_

- [ ] 6.3 駅検索APIエンドポイント作成
  - `/api/stations` エンドポイントを作成し、Google Directions APIサービスを呼び出す
  - 最寄り駅特定と駅数分のルート取得機能を実装する
  - エラーハンドリングと適切なレスポンス形式を設定する
  - _要件: 4.2, 4.3_

- [ ] 7. 位置情報取得カスタムフック実装
  - useGeolocationフックを作成し、navigator.geolocationで現在地を取得する
  - 位置情報取得の成功・失敗状態を管理する
  - 位置情報拒否時のエラーハンドリングを実装する
  - _要件: 3.2, 3.4_

- [ ] 8. 検索状態管理カスタムフック実装
  - useSearchStateフックを作成し、検索モード、気分、半径、駅数の状態を管理する
  - 検索実行、ローディング状態、エラー状態の管理機能を実装する
  - 検索結果の状態管理とキャッシュ機能を追加する
  - _要件: 1.4, 2.4, 3.1, 4.1_

- [ ] 9. API呼び出しカスタムフック実装
- [ ] 9.1 気分変換フック作成
  - useMoodConversionフックを作成し、気分変換APIを呼び出す
  - デバウンス処理で不要なAPI呼び出しを削減する
  - 変換結果のキャッシュ機能を実装する
  - _要件: 2.2, 2.3_

- [ ] 9.2 飲食店検索フック作成
  - usePlacesSearchフックを作成し、飲食店検索APIを呼び出す
  - 半径モードと駅数モードの両方に対応する検索ロジックを実装する
  - 検索結果の並び替えとフィルタリング機能を追加する
  - _要件: 3.3, 4.4, 5.1_

- [ ] 9.3 駅検索フック作成
  - useStationSearchフックを作成し、駅検索APIを呼び出す
  - 最寄り駅の特定と駅数分のルート取得機能を実装する
  - 駅情報のキャッシュとエラーハンドリングを追加する
  - _要件: 4.2, 4.3, 4.4_

- [ ] 10. モード切替UIコンポーネント実装
  - ModeToggleコンポーネントを作成し、半径モードと駅数モードの切り替えを実装する
  - タッチフレンドリーなトグルUIを作成し、44px以上のタップ領域を確保する
  - アクセシビリティ対応（ARIA属性、キーボード操作）を実装する
  - _要件: 1.1, 1.2, 1.3, 1.4, 7.2_

- [ ] 11. 気分入力UIコンポーネント実装
  - MoodInputコンポーネントを作成し、自由テキスト入力フィールドを実装する
  - リアルタイムでの入力値検証とフィードバック表示を追加する
  - プレースホルダーテキストとヘルプテキストを設定する
  - _要件: 2.1, 7.2_

- [ ] 12. 半径指定UIコンポーネント実装
  - RadiusSliderコンポーネントを作成し、500m〜5000mの範囲でスライダーを実装する
  - 現在値の表示とスムーズなスライダー操作を実現する
  - モバイル端末でのタッチ操作に最適化する
  - _要件: 3.1, 7.2_

- [ ] 13. 駅数指定UIコンポーネント実装
  - StationCounterコンポーネントを作成し、1〜5駅の範囲で駅数を指定できるUIを実装する
  - +/-ボタンまたはセレクトボックスで駅数を選択する機能を追加する
  - 選択された駅数の視覚的フィードバックを提供する
  - _要件: 4.1, 7.2_

- [ ] 14. 検索フォームコンポーネント実装
  - SearchFormコンポーネントを作成し、モード切替、気分入力、範囲指定を統合する
  - 検索ボタンの実装と検索実行時のローディング状態表示を追加する
  - フォーム全体のバリデーションとエラー表示機能を実装する
  - _要件: 1.4, 2.4, 3.1, 4.1_

- [ ] 15. 検索結果カードコンポーネント実装
  - ResultCardコンポーネントを作成し、店名、ジャンル、評価、写真を表示する
  - 半径モードでは距離、駅数モードでは最寄り駅名を表示する機能を実装する
  - 「Googleマップで開く」ボタンを配置し、適切なURLで遷移する機能を追加する
  - _要件: 5.1, 5.2, 5.3, 5.4, 5.5, 6.1, 6.2, 6.3_

- [ ] 16. 検索結果一覧コンポーネント実装
  - ResultListコンポーネントを作成し、検索結果カードを一覧表示する
  - 縦スクロール1カラムレイアウトでモバイル最適化を実現する
  - 検索結果が0件の場合の表示とエラー状態の表示を実装する
  - _要件: 5.1, 7.1, 7.3_

- [ ] 17. ローディングとエラー表示コンポーネント実装
  - Loaderコンポーネントを作成し、検索中の適切なローディング表示を実装する
  - ErrorMessageコンポーネントを作成し、ユーザーフレンドリーなエラーメッセージを表示する
  - リトライボタンとエラー回復機能を追加する
  - _要件: 7.4_

- [ ] 18. メインページコンポーネント統合
  - Homeページコンポーネントを作成し、全てのUIコンポーネントを統合する
  - 検索フローの全体的な状態管理と画面遷移を実装する
  - レスポンシブデザインでスマートフォン表示を最適化する
  - _要件: 7.1, 7.3_

- [ ] 19. スマートフォン対応とアクセシビリティ改善
  - 全コンポーネントでタップ領域44px以上を確保し、タッチ操作を最適化する
  - ARIA属性、セマンティックHTML、キーボード操作対応を実装する
  - 画面サイズに応じたレスポンシブレイアウトを調整する
  - _要件: 7.1, 7.2, 7.3_

- [ ] 20. エラーハンドリングとユーザー体験向上
  - 位置情報拒否、ネットワークエラー、API呼び出し失敗の各エラーケースに対応する
  - 非侵入的なトースト通知とインラインエラーメッセージを実装する
  - リトライ機能とフォールバック検索機能を追加する
  - _要件: 3.4_

- [ ] 21. パフォーマンス最適化実装
  - React.memo、useMemo、useCallbackを使用してコンポーネントの再レンダリングを最適化する
  - 画像の遅延読み込み（Lazy Loading）を実装する
  - バンドルサイズの最適化とTree Shakingを確認する
  - _要件: 7.3_

- [ ] 22. テスト実装
- [ ] 22.1 ユニットテスト作成
  - カスタムフック（useGeolocation、useMoodConversion、usePlacesSearch）のテストを作成する
  - ユーティリティ関数とAPIサービス関数のテストを実装する
  - Jest + React Testing Libraryを使用してテスト環境を構築する

- [ ] 22.2 コンポーネントテスト作成
  - 各UIコンポーネントの描画テストとユーザーインタラクションテストを作成する
  - プロップスの受け渡しとイベントハンドリングのテストを実装する
  - MSWを使用してAPIモックを設定する

- [ ] 22.3 統合テスト作成
  - API Routesのエンドポイントテストを作成する
  - フロントエンド・バックエンド間の通信テストを実装する
  - エラーケースとエッジケースのテストを追加する

- [ ] 23. Docker環境最終調整とドキュメント作成
  - 本番環境想定のマルチステージビルドを実装する
  - README.mdに環境構築手順、API設定方法、使用方法を記載する
  - .env.exampleファイルを完成させ、必要なAPIキーの取得方法を説明する
  - _要件: 8.1, 8.2, 8.3, 8.4, 9.1, 9.2, 9.3, 9.4_