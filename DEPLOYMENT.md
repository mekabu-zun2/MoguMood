# ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚¬ã‚¤ãƒ‰ ğŸš€

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€ã€Œã”é£¯æ¢ç´¢ãƒãƒƒãƒ—ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æœ¬ç•ªç’°å¢ƒã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

## ğŸ“‹ ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆå‰ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### å¿…é ˆè¦ä»¶
- [ ] Google Places API ã‚­ãƒ¼ã®å–å¾—ã¨è¨­å®š
- [ ] Google Directions API ã‚­ãƒ¼ã®å–å¾—ã¨è¨­å®š  
- [ ] Gemini API ã‚­ãƒ¼ã®å–å¾—ã¨è¨­å®š
- [ ] ãƒ‰ãƒ¡ã‚¤ãƒ³åã®å–å¾—ï¼ˆHTTPSå¿…é ˆï¼‰
- [ ] SSLè¨¼æ˜æ›¸ã®æº–å‚™
- [ ] Docker ã¨ Docker Compose ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯
- [ ] APIã‚­ãƒ¼ã®æ¨©é™è¨­å®šï¼ˆå¿…è¦æœ€å°é™ã«åˆ¶é™ï¼‰
- [ ] CORSè¨­å®šã®ç¢ºèª
- [ ] ç’°å¢ƒå¤‰æ•°ã®é©åˆ‡ãªç®¡ç†
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ã®è¨­å®š

## ğŸ”§ APIè¨­å®š

### Google Cloud Consoleè¨­å®š

1. **Google Cloud Consoleã«ã‚¢ã‚¯ã‚»ã‚¹**
   - [Google Cloud Console](https://console.cloud.google.com/) ã«ãƒ­ã‚°ã‚¤ãƒ³
   - æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã¾ãŸã¯æ—¢å­˜ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠ

2. **å¿…è¦ãªAPIã‚’æœ‰åŠ¹åŒ–**
   ```
   - Places API (New)
   - Places API  
   - Directions API
   - Maps JavaScript APIï¼ˆå°†æ¥ã®æ‹¡å¼µç”¨ï¼‰
   ```

3. **APIã‚­ãƒ¼ã®ä½œæˆ**
   - ã€Œèªè¨¼æƒ…å ±ã€â†’ã€Œèªè¨¼æƒ…å ±ã‚’ä½œæˆã€â†’ã€ŒAPIã‚­ãƒ¼ã€
   - ä½œæˆã•ã‚ŒãŸAPIã‚­ãƒ¼ã‚’å®‰å…¨ã«ä¿ç®¡

4. **APIã‚­ãƒ¼ã®åˆ¶é™è¨­å®š**
   ```
   ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®åˆ¶é™:
   - HTTPãƒªãƒ•ã‚¡ãƒ©ãƒ¼: https://your-domain.com/*
   
   APIåˆ¶é™:
   - Places API (New)
   - Places API
   - Directions API
   ```

### Gemini APIè¨­å®š

1. **Google AI Studioã«ã‚¢ã‚¯ã‚»ã‚¹**
   - [Google AI Studio](https://ai.google.dev/) ã«ã‚¢ã‚¯ã‚»ã‚¹
   - Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³

2. **APIã‚­ãƒ¼ã®ç”Ÿæˆ**
   - ã€ŒGet API Keyã€ã‚’ã‚¯ãƒªãƒƒã‚¯
   - æ–°ã—ã„APIã‚­ãƒ¼ã‚’ç”Ÿæˆ
   - APIã‚­ãƒ¼ã‚’å®‰å…¨ã«ä¿ç®¡

## ğŸ³ Docker ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ

### 1. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

æœ¬ç•ªç’°å¢ƒç”¨ã®ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆï¼š

```bash
# .env.production ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
cp .env.example .env.production
```

`.env.production` ã‚’ç·¨é›†ï¼š
```bash
# æœ¬ç•ªç’°å¢ƒè¨­å®š
NODE_ENV=production
NEXT_PUBLIC_APP_URL=https://your-domain.com

# APIã‚­ãƒ¼
GOOGLE_PLACES_API_KEY=your_production_google_places_api_key
GOOGLE_DIRECTIONS_API_KEY=your_production_google_directions_api_key
GEMINI_API_KEY=your_production_gemini_api_key
```

### 2. æœ¬ç•ªç”¨ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰

```bash
# æœ¬ç•ªç”¨Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰
docker build -f Dockerfile.production -t food-exploration-map:latest .
```

### 3. æœ¬ç•ªç’°å¢ƒã§ã®èµ·å‹•

```bash
# æœ¬ç•ªç’°å¢ƒç”¨docker-composeã§èµ·å‹•
docker-compose -f docker-compose.production.yml up -d
```

### 4. ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯

```bash
# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å¥å…¨æ€§ã‚’ç¢ºèª
curl http://localhost:3000/api/health
```

## ğŸŒ ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ¥ãƒ‡ãƒ—ãƒ­ã‚¤

### Vercel ãƒ‡ãƒ—ãƒ­ã‚¤

1. **Vercelã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ**
   - [Vercel](https://vercel.com/) ã§ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ
   - GitHubãƒªãƒã‚¸ãƒˆãƒªã¨é€£æº

2. **ç’°å¢ƒå¤‰æ•°è¨­å®š**
   ```
   Vercel Dashboard â†’ Settings â†’ Environment Variables
   
   GOOGLE_PLACES_API_KEY=your_key
   GOOGLE_DIRECTIONS_API_KEY=your_key  
   GEMINI_API_KEY=your_key
   NEXT_PUBLIC_APP_URL=https://your-app.vercel.app
   ```

3. **ãƒ‡ãƒ—ãƒ­ã‚¤**
   ```bash
   # Vercel CLIã‚’ä½¿ç”¨
   npm i -g vercel
   vercel --prod
   ```

### AWS ECS ãƒ‡ãƒ—ãƒ­ã‚¤

1. **ECRãƒªãƒã‚¸ãƒˆãƒªä½œæˆ**
   ```bash
   aws ecr create-repository --repository-name food-exploration-map
   ```

2. **ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ—ãƒƒã‚·ãƒ¥**
   ```bash
   # ECRã«ãƒ­ã‚°ã‚¤ãƒ³
   aws ecr get-login-password --region ap-northeast-1 | docker login --username AWS --password-stdin <account-id>.dkr.ecr.ap-northeast-1.amazonaws.com
   
   # ã‚¤ãƒ¡ãƒ¼ã‚¸ã«ã‚¿ã‚°ä»˜ã‘
   docker tag food-exploration-map:latest <account-id>.dkr.ecr.ap-northeast-1.amazonaws.com/food-exploration-map:latest
   
   # ãƒ—ãƒƒã‚·ãƒ¥
   docker push <account-id>.dkr.ecr.ap-northeast-1.amazonaws.com/food-exploration-map:latest
   ```

3. **ECSã‚µãƒ¼ãƒ“ã‚¹ä½œæˆ**
   - ECSã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’ä½œæˆ
   - ã‚¿ã‚¹ã‚¯å®šç¾©ã‚’ä½œæˆï¼ˆç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šï¼‰
   - ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½œæˆã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤

### Google Cloud Run ãƒ‡ãƒ—ãƒ­ã‚¤

1. **gcloudã®è¨­å®š**
   ```bash
   gcloud auth login
   gcloud config set project your-project-id
   ```

2. **Container Registryã«ãƒ—ãƒƒã‚·ãƒ¥**
   ```bash
   # ã‚¤ãƒ¡ãƒ¼ã‚¸ã«ã‚¿ã‚°ä»˜ã‘
   docker tag food-exploration-map:latest gcr.io/your-project-id/food-exploration-map
   
   # ãƒ—ãƒƒã‚·ãƒ¥
   docker push gcr.io/your-project-id/food-exploration-map
   ```

3. **Cloud Runã«ãƒ‡ãƒ—ãƒ­ã‚¤**
   ```bash
   gcloud run deploy food-exploration-map \
     --image gcr.io/your-project-id/food-exploration-map \
     --platform managed \
     --region asia-northeast1 \
     --allow-unauthenticated \
     --set-env-vars GOOGLE_PLACES_API_KEY=your_key,GOOGLE_DIRECTIONS_API_KEY=your_key,GEMINI_API_KEY=your_key
   ```

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š

### SSL/TLSè¨¼æ˜æ›¸

1. **Let's Encryptä½¿ç”¨ï¼ˆæ¨å¥¨ï¼‰**
   ```bash
   # Certbotã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
   sudo apt-get install certbot python3-certbot-nginx
   
   # è¨¼æ˜æ›¸ã®å–å¾—
   sudo certbot --nginx -d your-domain.com
   ```

2. **Nginxè¨­å®šä¾‹**
   ```nginx
   server {
       listen 80;
       server_name your-domain.com;
       return 301 https://$server_name$request_uri;
   }
   
   server {
       listen 443 ssl http2;
       server_name your-domain.com;
       
       ssl_certificate /etc/letsencrypt/live/your-domain.com/fullchain.pem;
       ssl_certificate_key /etc/letsencrypt/live/your-domain.com/privkey.pem;
       
       location / {
           proxy_pass http://localhost:3000;
           proxy_set_header Host $host;
           proxy_set_header X-Real-IP $remote_addr;
           proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
           proxy_set_header X-Forwarded-Proto $scheme;
       }
   }
   ```

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼

Next.jsè¨­å®šï¼ˆ`next.config.js`ï¼‰ã§ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¨­å®šæ¸ˆã¿ï¼š
- X-Frame-Options: DENY
- X-Content-Type-Options: nosniff  
- Referrer-Policy: origin-when-cross-origin
- Permissions-Policy: geolocation=(self)

## ğŸ“Š ç›£è¦–ã¨ãƒ­ã‚°

### ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯è¨­å®š

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ `/api/health` ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚’æä¾›ï¼š

```bash
# å®šæœŸçš„ãªãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
curl -f http://your-domain.com/api/health || exit 1
```

### ãƒ­ã‚°ç›£è¦–

```bash
# Dockerãƒ­ã‚°ã®ç¢ºèª
docker-compose -f docker-compose.production.yml logs -f app

# ãƒ­ã‚°ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
docker-compose -f docker-compose.production.yml logs --tail=1000 app
```

## ğŸš€ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### CDNè¨­å®š

1. **CloudFlareè¨­å®š**
   - DNSè¨­å®šã§CloudFlareã‚’çµŒç”±
   - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ«ãƒ¼ãƒ«ã®è¨­å®š
   - ç”»åƒæœ€é©åŒ–ã®æœ‰åŠ¹åŒ–

2. **AWS CloudFrontè¨­å®š**
   - ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆ
   - ã‚ªãƒªã‚¸ãƒ³ã®è¨­å®š
   - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ“ãƒ˜ã‚¤ãƒ“ã‚¢ã®è¨­å®š

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆå°†æ¥ã®æ‹¡å¼µï¼‰

ç¾åœ¨ã¯ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹ã§ã™ãŒã€å°†æ¥çš„ã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’è¿½åŠ ã™ã‚‹å ´åˆï¼š

1. **PostgreSQL**
   ```bash
   # Docker Composeã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’è¿½åŠ 
   services:
     db:
       image: postgres:15-alpine
       environment:
         POSTGRES_DB: food_exploration_map
         POSTGRES_USER: app_user
         POSTGRES_PASSWORD: secure_password
       volumes:
         - postgres_data:/var/lib/postgresql/data
   ```

2. **Redisï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ç”¨ï¼‰**
   ```bash
   services:
     redis:
       image: redis:7-alpine
       command: redis-server --appendonly yes
       volumes:
         - redis_data:/data
   ```

## ğŸ”„ CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

### GitHub Actionsè¨­å®šä¾‹

`.github/workflows/deploy.yml`:
```yaml
name: Deploy to Production

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Build Docker image
        run: docker build -f Dockerfile.production -t food-exploration-map .
      
      - name: Run tests
        run: docker run --rm food-exploration-map npm test
      
      - name: Deploy to production
        run: |
          # ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ
          ./deploy.sh
```

## ğŸ“ˆ ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°

### æ°´å¹³ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°

```yaml
# docker-compose.production.yml
services:
  app:
    deploy:
      replicas: 3
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 256M
```

### ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼è¨­å®š

```nginx
upstream app_servers {
    server app1:3000;
    server app2:3000;
    server app3:3000;
}

server {
    location / {
        proxy_pass http://app_servers;
    }
}
```

## ğŸ†˜ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

1. **APIã‚­ãƒ¼ã‚¨ãƒ©ãƒ¼**
   ```bash
   # ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã§APIã‚­ãƒ¼ã®çŠ¶æ…‹ç¢ºèª
   curl http://your-domain.com/api/health
   ```

2. **ãƒ¡ãƒ¢ãƒªä¸è¶³**
   ```bash
   # ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®ç¢ºèª
   docker stats
   
   # ãƒ¡ãƒ¢ãƒªåˆ¶é™ã®èª¿æ•´
   docker-compose -f docker-compose.production.yml up -d --scale app=2
   ```

3. **SSLè¨¼æ˜æ›¸ã‚¨ãƒ©ãƒ¼**
   ```bash
   # è¨¼æ˜æ›¸ã®æ›´æ–°
   sudo certbot renew
   
   # Nginxã®å†èµ·å‹•
   sudo systemctl reload nginx
   ```

## ğŸ“ ã‚µãƒãƒ¼ãƒˆ

ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã«é–¢ã™ã‚‹å•é¡Œã‚„è³ªå•ãŒã‚ã‚‹å ´åˆã¯ã€ä»¥ä¸‹ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’å‚ç…§ã—ã¦ãã ã•ã„ï¼š

- [Next.js ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://nextjs.org/docs/deployment)
- [Docker å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.docker.com/)
- [Google Cloud API ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://cloud.google.com/apis/docs)

---

**Happy Deploying! ğŸš€**